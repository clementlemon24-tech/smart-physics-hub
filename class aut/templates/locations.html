{% extends "base.html" %}

{% block title %}Locations - Pest Tracker{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-8">
        <h1><i class="fas fa-map-marker-alt"></i> Locations</h1>
    </div>
    <div class="col-md-4 text-end">
        <a href="{{ url_for('add_location') }}" class="btn btn-primary">
            <i class="fas fa-plus"></i> Add Location
        </a>
    </div>
</div>

<div class="row">
    {% for location in locations %}
    <div class="col-md-6 mb-3">
        <div class="card">
            <div class="card-header">
                <h5>{{ location.name }}</h5>
            </div>
            <div class="card-body">
                <p><i class="fas fa-map-marker-alt"></i> {{ location.address }}</p>
                {% if location.coordinates %}
                <p><i class="fas fa-globe"></i> {{ location.coordinates[0] }}, {{ location.coordinates[1] }}</p>
                {% endif %}
                <p><small class="text-muted">Added: {{ location.created_at.strftime('%Y-%m-%d') }}</small></p>
                
                <!-- Show recent sightings for this location -->
                {% set location_sightings = [] %}
                {% for sighting in pest_tracker.sightings if sighting.location.id == location.id %}
                    {% set _ = location_sightings.append(sighting) %}
                {% endfor %}
                
                {% if location_sightings %}
                <div class="mt-3">
                    <h6>Recent Activity:</h6>
                    {% for sighting in location_sightings[-3:] %}
                    <div class="small mb-1">
                        <span class="severity-{{ sighting.severity.value }}">{{ sighting.pest.name }}</span>
                        - {{ sighting.sighting_date.strftime('%m/%d') }}
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    {% endfor %}
</div>

{% if not locations %}
<div class="text-center mt-5">
    <i class="fas fa-map-marker-alt fa-3x text-muted mb-3"></i>
    <h3>No locations added yet</h3>
    <p class="text-muted">Start by adding your first location to track pest activity.</p>
    <a href="{{ url_for('add_location') }}" class="btn btn-primary">
        <i class="fas fa-plus"></i> Add First Location
    </a>
</div>
{% endif %}
{% endblock %}