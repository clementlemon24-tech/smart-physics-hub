{% extends "base.html" %}

{% block title %}{{ lesson.lesson_title }} - Smart Physics Hub{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{{ url_for('dashboard') }}">Dashboard</a></li>
                <li class="breadcrumb-item"><a href="{{ url_for('lessons') }}">Lessons</a></li>
                <li class="breadcrumb-item">{{ lesson.category }}</li>
                <li class="breadcrumb-item active">{{ lesson.lesson_title }}</li>
            </ol>
        </nav>
        
        <div class="d-flex align-items-center mb-3">
            <i class="{{ lesson.icon }} fa-3x text-{{ lesson.color }} me-3"></i>
            <div>
                <h1>{{ lesson.lesson_title }}</h1>
                <p class="lead mb-0">{{ lesson.description }}</p>
            </div>
        </div>
    </div>
</div>

<!-- Lesson Progress -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card border-{{ lesson.color }}">
            <div class="card-header bg-{{ lesson.color }} text-white">
                <h5><i class="fas fa-chart-line"></i> Lesson Progress</h5>
            </div>
            <div class="card-body">
                <div class="progress mb-2">
                    <div class="progress-bar bg-{{ lesson.color }}" role="progressbar" style="width: 0%" id="lessonProgress">
                        <span id="progressText">0% Complete</span>
                    </div>
                </div>
                <small class="text-muted">Complete each section to advance</small>
            </div>
        </div>
    </div>
</div>

<!-- Interactive Lesson Content -->
<div class="row">
    <!-- Main Content -->
    <div class="col-lg-8">
        <!-- Introduction Section -->
        <div class="card mb-4 lesson-section" data-section="intro">
            <div class="card-header bg-light">
                <h5><i class="fas fa-info-circle"></i> Introduction</h5>
            </div>
            <div class="card-body">
                <p>{{ lesson.description }}</p>
                <p>In this lesson, you'll learn about the fundamental concepts, key formulas, and real-world applications of {{ lesson.lesson_title.lower() }}.</p>
                
                <div class="alert alert-info">
                    <i class="fas fa-lightbulb"></i> <strong>Learning Objectives:</strong>
                    <ul class="mb-0 mt-2">
                        <li>Understand the basic principles of {{ lesson.lesson_title.lower() }}</li>
                        <li>Master the key formulas and their applications</li>
                        <li>Solve practical problems using these concepts</li>
                        <li>Connect theory to real-world examples</li>
                    </ul>
                </div>
                
                <button class="btn btn-{{ lesson.color }} complete-section" data-section="intro">
                    <i class="fas fa-check"></i> Mark as Complete
                </button>
            </div>
        </div>

        <!-- Key Formulas Section -->
        <div class="card mb-4 lesson-section" data-section="formulas">
            <div class="card-header bg-light">
                <h5><i class="fas fa-calculator"></i> Key Formulas</h5>
            </div>
            <div class="card-body">
                {% if lesson.formulas %}
                    {% for formula, description in lesson.formulas.items() %}
                    <div class="formula-card p-3 mb-3 border rounded">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="formula-display bg-light p-2 rounded text-center">
                                    <code class="fs-5">{{ formula }}</code>
                                </div>
                            </div>
                            <div class="col-md-8">
                                <p class="mb-0"><strong>Description:</strong> {{ description }}</p>
                                <button class="btn btn-sm btn-outline-{{ lesson.color }} mt-2 formula-example" 
                                        data-formula="{{ formula }}">
                                    <i class="fas fa-play"></i> See Example
                                </button>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <p>Formulas for this topic are being prepared. Check back soon!</p>
                {% endif %}
                
                <button class="btn btn-{{ lesson.color }} complete-section" data-section="formulas">
                    <i class="fas fa-check"></i> Mark as Complete
                </button>
            </div>
        </div>

        <!-- Examples Section -->
        <div class="card mb-4 lesson-section" data-section="examples">
            <div class="card-header bg-light">
                <h5><i class="fas fa-lightbulb"></i> Real-World Examples</h5>
            </div>
            <div class="card-body">
                {% if lesson.examples %}
                    {% for example in lesson.examples %}
                    <div class="example-card p-3 mb-3 border-start border-{{ lesson.color }} border-3 bg-light">
                        <h6><i class="fas fa-star text-{{ lesson.color }}"></i> Example {{ loop.index }}</h6>
                        <p>{{ example }}</p>
                        <button class="btn btn-sm btn-outline-{{ lesson.color }} explore-example" 
                                data-example="{{ example }}">
                            <i class="fas fa-search"></i> Explore Further
                        </button>
                    </div>
                    {% endfor %}
                {% else %}
                    <p>Examples for this topic are being prepared. Check back soon!</p>
                {% endif %}
                
                <button class="btn btn-{{ lesson.color }} complete-section" data-section="examples">
                    <i class="fas fa-check"></i> Mark as Complete
                </button>
            </div>
        </div>

        <!-- Applications Section -->
        <div class="card mb-4 lesson-section" data-section="applications">
            <div class="card-header bg-light">
                <h5><i class="fas fa-cogs"></i> Applications</h5>
            </div>
            <div class="card-body">
                {% if lesson.applications %}
                    <div class="row">
                        {% for application in lesson.applications %}
                        <div class="col-md-6 mb-3">
                            <div class="application-card h-100 p-3 border rounded">
                                <h6><i class="fas fa-arrow-right text-{{ lesson.color }}"></i> {{ application }}</h6>
                                <p class="small text-muted">Learn how {{ lesson.lesson_title.lower() }} is used in {{ application.lower() }}</p>
                                <button class="btn btn-sm btn-outline-{{ lesson.color }} learn-application" 
                                        data-app="{{ application }}">
                                    <i class="fas fa-book"></i> Learn More
                                </button>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <p>Applications for this topic are being prepared. Check back soon!</p>
                {% endif %}
                
                <button class="btn btn-{{ lesson.color }} complete-section" data-section="applications">
                    <i class="fas fa-check"></i> Mark as Complete
                </button>
            </div>
        </div>

        <!-- Practice Section -->
        <div class="card mb-4 lesson-section" data-section="practice">
            <div class="card-header bg-light">
                <h5><i class="fas fa-pencil-alt"></i> Practice Problems</h5>
            </div>
            <div class="card-body">
                <div class="alert alert-warning">
                    <i class="fas fa-dumbbell"></i> <strong>Ready to Practice?</strong>
                    <p class="mb-0">Test your understanding with interactive problems and get instant feedback!</p>
                </div>
                
                <div class="d-grid gap-2">
                    <button class="btn btn-{{ lesson.color }} btn-lg start-practice">
                        <i class="fas fa-play"></i> Start Practice Problems
                    </button>
                    <button class="btn btn-outline-{{ lesson.color }} take-quiz">
                        <i class="fas fa-clipboard-check"></i> Take Quiz
                    </button>
                </div>
                
                <button class="btn btn-{{ lesson.color }} complete-section mt-3" data-section="practice">
                    <i class="fas fa-check"></i> Mark as Complete
                </button>
            </div>
        </div>
    </div>

    <!-- Sidebar -->
    <div class="col-lg-4">
        <!-- AI Tutor Help -->
        <div class="card mb-4">
            <div class="card-header bg-success text-white">
                <h6><i class="fas fa-robot"></i> AI Tutor Available</h6>
            </div>
            <div class="card-body">
                <p class="small">Need help understanding this topic? Ask Engineer Clement Ekelemchi!</p>
                <a href="{{ url_for('ai_tutor_page') }}" class="btn btn-success btn-sm">
                    <i class="fas fa-comments"></i> Ask AI Tutor
                </a>
            </div>
        </div>

        <!-- Quick Navigation -->
        <div class="card mb-4">
            <div class="card-header">
                <h6><i class="fas fa-list"></i> Lesson Sections</h6>
            </div>
            <div class="card-body p-0">
                <div class="list-group list-group-flush">
                    <a href="#" class="list-group-item list-group-item-action section-nav" data-target="intro">
                        <i class="fas fa-info-circle"></i> Introduction
                        <span class="badge bg-secondary ms-auto section-status" id="intro-status">Pending</span>
                    </a>
                    <a href="#" class="list-group-item list-group-item-action section-nav" data-target="formulas">
                        <i class="fas fa-calculator"></i> Key Formulas
                        <span class="badge bg-secondary ms-auto section-status" id="formulas-status">Pending</span>
                    </a>
                    <a href="#" class="list-group-item list-group-item-action section-nav" data-target="examples">
                        <i class="fas fa-lightbulb"></i> Examples
                        <span class="badge bg-secondary ms-auto section-status" id="examples-status">Pending</span>
                    </a>
                    <a href="#" class="list-group-item list-group-item-action section-nav" data-target="applications">
                        <i class="fas fa-cogs"></i> Applications
                        <span class="badge bg-secondary ms-auto section-status" id="applications-status">Pending</span>
                    </a>
                    <a href="#" class="list-group-item list-group-item-action section-nav" data-target="practice">
                        <i class="fas fa-pencil-alt"></i> Practice
                        <span class="badge bg-secondary ms-auto section-status" id="practice-status">Pending</span>
                    </a>
                </div>
            </div>
        </div>

        <!-- Related Topics -->
        <div class="card">
            <div class="card-header">
                <h6><i class="fas fa-link"></i> Related Topics</h6>
            </div>
            <div class="card-body">
                <p class="small">Explore related physics concepts:</p>
                <div class="d-grid gap-1">
                    <a href="{{ url_for('lessons') }}" class="btn btn-outline-primary btn-sm">
                        <i class="fas fa-book"></i> All Lessons
                    </a>
                    <a href="{{ url_for('ai_tutor_page') }}" class="btn btn-outline-success btn-sm">
                        <i class="fas fa-robot"></i> AI Tutor
                    </a>
                    <a href="{{ url_for('virtual_lab') }}" class="btn btn-outline-info btn-sm">
                        <i class="fas fa-flask"></i> Virtual Lab
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Interactive Modals -->
<div class="modal fade" id="formulaModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Formula Example</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="formulaModalBody">
                <!-- Dynamic content -->
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="exampleModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Detailed Example</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="exampleModalBody">
                <!-- Dynamic content -->
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    let completedSections = new Set();
    const totalSections = 5;

    // Section completion tracking
    document.querySelectorAll('.complete-section').forEach(button => {
        button.addEventListener('click', function() {
            const section = this.dataset.section;
            completedSections.add(section);
            
            // Update UI
            this.innerHTML = '<i class="fas fa-check-circle"></i> Completed';
            this.classList.remove('btn-{{ lesson.color }}');
            this.classList.add('btn-success');
            this.disabled = true;
            
            // Update sidebar status
            const statusBadge = document.getElementById(section + '-status');
            statusBadge.textContent = 'Complete';
            statusBadge.classList.remove('bg-secondary');
            statusBadge.classList.add('bg-success');
            
            // Update progress bar
            updateProgress();
        });
    });

    // Section navigation
    document.querySelectorAll('.section-nav').forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const target = this.dataset.target;
            const targetElement = document.querySelector(`[data-section="${target}"]`);
            if (targetElement) {
                targetElement.scrollIntoView({ behavior: 'smooth' });
            }
        });
    });

    // Formula examples
    document.querySelectorAll('.formula-example').forEach(button => {
        button.addEventListener('click', function() {
            const formula = this.dataset.formula;
            showFormulaExample(formula);
        });
    });

    // Example exploration
    document.querySelectorAll('.explore-example').forEach(button => {
        button.addEventListener('click', function() {
            const example = this.dataset.example;
            showDetailedExample(example);
        });
    });

    // Application learning
    document.querySelectorAll('.learn-application').forEach(button => {
        button.addEventListener('click', function() {
            const app = this.dataset.app;
            alert(`Learning more about ${app} applications! This feature will open detailed content soon.`);
        });
    });

    // Practice problems
    document.querySelector('.start-practice')?.addEventListener('click', function() {
        alert('Practice problems are being prepared! This will open an interactive problem set soon.');
    });

    document.querySelector('.take-quiz')?.addEventListener('click', function() {
        alert('Quiz feature coming soon! This will test your knowledge of {{ lesson.lesson_title }}.');
    });

    function updateProgress() {
        const progress = (completedSections.size / totalSections) * 100;
        const progressBar = document.getElementById('lessonProgress');
        const progressText = document.getElementById('progressText');
        
        progressBar.style.width = progress + '%';
        progressText.textContent = Math.round(progress) + '% Complete';
        
        if (progress === 100) {
            progressBar.classList.add('bg-success');
            showCompletionCelebration();
        }
    }

    function showFormulaExample(formula) {
        const modalBody = document.getElementById('formulaModalBody');
        modalBody.innerHTML = `
            <div class="text-center mb-3">
                <h4><code>${formula}</code></h4>
            </div>
            <div class="alert alert-info">
                <h6>Example Problem:</h6>
                <p>Here's how to use this formula in a practical problem...</p>
                <p><strong>Given:</strong> Sample values</p>
                <p><strong>Solution:</strong> Step-by-step calculation</p>
                <p><strong>Answer:</strong> Final result with units</p>
            </div>
            <p><em>More detailed examples will be added soon!</em></p>
        `;
        new bootstrap.Modal(document.getElementById('formulaModal')).show();
    }

    function showDetailedExample(example) {
        const modalBody = document.getElementById('exampleModalBody');
        modalBody.innerHTML = `
            <h5>${example}</h5>
            <div class="alert alert-success">
                <h6>Detailed Explanation:</h6>
                <p>This example demonstrates the practical application of {{ lesson.lesson_title.lower() }} in real-world scenarios.</p>
                <p><strong>Physics Principles:</strong> Key concepts involved</p>
                <p><strong>Mathematical Analysis:</strong> Relevant calculations</p>
                <p><strong>Real-World Impact:</strong> Why this matters</p>
            </div>
            <p><em>More detailed analysis will be added soon!</em></p>
        `;
        new bootstrap.Modal(document.getElementById('exampleModal')).show();
    }

    function showCompletionCelebration() {
        setTimeout(() => {
            alert('ðŸŽ‰ Congratulations! You have completed this lesson. Great job learning about {{ lesson.lesson_title }}!');
        }, 500);
    }
});
</script>

<style>
.formula-card {
    transition: all 0.3s ease;
}

.formula-card:hover {
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    transform: translateY(-2px);
}

.example-card {
    transition: all 0.3s ease;
}

.example-card:hover {
    background-color: #f8f9fa !important;
}

.application-card {
    transition: all 0.3s ease;
}

.application-card:hover {
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.section-nav:hover {
    background-color: #f8f9fa;
}

.progress-bar {
    transition: width 0.5s ease;
}
</style>
{% endblock %}